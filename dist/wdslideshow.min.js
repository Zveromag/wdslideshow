Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(t){for(var i=(this.document||this.ownerDocument).querySelectorAll(t),e=i.length;--e>=0&&i.item(e)!==this;);return e>-1}),Element.prototype.closest||(Element.prototype.closest=function(t){for(var i=this;i;){if(i.matches(t))return i;i=i.parentElement}return null}),function(t){"use strict";function i(){var t=document.body,i={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var e in i)if(void 0!==t.style[e])return i[e];return!1}function e(t){this.currentImg=0,this.isAnimate=!1,this.initEvent=this.init.bind(this),this.closeWindow=this.close.bind(this),this.hideWrap=this.hide.bind(this),this.resize=this.resize.bind(this),this.move=this.move.bind(this),this.keyEvents=this.keyEvents.bind(this),this.option=function(t,i){for(var e in i)t.hasOwnProperty(e)&&(t[e]=i[e]);return t}(e.settings,t),document.body.addEventListener("click",this.initEvent)}e.settings={arrows:!0,caption:!0,keyboard:!0,onChange:function(){}},e.prototype.init=function(t){var i=t.target.closest("[data-wdgal]");if(i){var e=i.dataset.wdgal,o=Array.prototype.slice.call(document.querySelectorAll('[data-wdgal="'+e+'"]'));this.album=o.map(function(t){return{source:t.dataset.src,caption:t.dataset.caption}});for(var n=0;n<o.length;n++)o[n]===i&&(this.currentImg=n);this.render(),this.show()}},e.prototype.render=function(){this.mainWindow=document.createElement("div"),this.mainWindow.className="slideshow";var t='<div class="slideshow__body"><button class="slideshow__icon-close"></button><div class="slideshow__preload"><div></div></div>'+(this.album.length>1&&this.option.arrows?'<div class="slideshow__navigation"><button class="slideshow__arrow slideshow__arrow-prev"></button><button class="slideshow__arrow slideshow__arrow-next"></button></div>':"")+'<div class="slideshow__img-wrap"></div></div>';this.mainWindow.innerHTML=t,this.slideBody=this.mainWindow.querySelector(".slideshow__body"),this.close=this.mainWindow.querySelector(".slideshow__icon-close"),this.preload=this.mainWindow.querySelector(".slideshow__preload"),this.imgWrap=this.slideBody.querySelector(".slideshow__img-wrap"),this.album.length>1&&this.option.arrows&&(this.control=this.mainWindow.querySelector(".slideshow__navigation"),this.navigate()),this.caption=this.album[this.currentImg].caption},e.prototype.show=function(e){if(!this.isAnimate){var o=this;o.isAnimate=!0;var n=new Image;n.className="slideshow__img",o.imgWrap.style.opacity=0,n.onload=function(){o.hideWrap(),o.imgWrap.appendChild(n),o.imgWidth=n.naturalWidth,o.imgHeight=n.naturalHeight,o.resize(),setTimeout(function(){o.imgWrap.style.opacity=1},0),o.imgWrap.addEventListener(i(),function t(i){o.imgWrap.removeEventListener(i.type,t),o.isAnimate=!1})},n.src=this.album[this.currentImg].source,o.option.caption&&o.showCaption(),t.addEventListener("resize",this.resize),document.body.appendChild(this.mainWindow),this.album.length>1&&this.option.keyboard&&document.body.addEventListener("keyup",this.keyEvents),this.close.addEventListener("click",this.closeWindow)}},e.prototype.showCaption=function(){"undefined"!==this.caption&&""!==this.caption&&(this.captionBlock=document.createElement("div"),this.captionBlock.className="slideshow__caption",this.captionBlock.textContent=this.caption,this.slideBody.appendChild(this.captionBlock))},e.prototype.resize=function(){var i=t.innerHeight-100,e=t.innerWidth-100,o=Math.min(e/this.imgWidth,i/this.imgHeight);o>1&&(o=1),this.imgWrap.querySelector("img").style[function(t){for(var i=document.documentElement,e=["-o-","-webkit-","-moz-",""],o=e.length-1;o>=0;o--)if((t=(e[o]+t).replace(/\-([a-z])/gi,function(t,i){return i.toUpperCase()}))in i.style)return t;return!1}("transform")]="translate(-50%, -50%) scale("+o+")"},e.prototype.hide=function(){this.option.caption&&this.captionBlock&&this.captionBlock.parentNode.removeChild(this.captionBlock),this.imgWrap.querySelector("img")&&this.imgWrap.removeChild(this.imgWrap.querySelector("img"))},e.prototype.navigate=function(t){this.control.addEventListener("click",this.move)},e.prototype.move=function(t){if(!this.isAnimate){"keyup"===t.type?37===t.which?this.prevSlide():this.nextSlide():t.target.closest(".slideshow__arrow").classList.contains("slideshow__arrow-next")?this.nextSlide():this.prevSlide();var e=this;e.isAnimate=!0,e.imgWrap.style.opacity=0,e.imgWrap.addEventListener(i(),function t(i){e.imgWrap.removeEventListener(i.type,t),e.isAnimate=!1,e.show()})}},e.prototype.nextSlide=function(){this.album.length>this.currentImg+1?this.currentImg+=1:this.currentImg=0},e.prototype.prevSlide=function(){this.currentImg>0?this.currentImg-=1:this.currentImg=this.album.length-1},e.prototype.close=function(){this.close.removeEventListener("click",this.closeWindow),this.album.length>1&&this.option.arrows&&this.control.removeEventListener("click",this.move),this.option.keyboard&&document.body.removeEventListener("keyup",this.keyEvents),this.mainWindow.parentNode.removeChild(this.mainWindow),this.mainWindow=null},e.prototype.keyEvents=function(t){var i=t.which;39!==i&&37!==i||this.move(t),27===i&&this.closeWindow()},e.prototype.destroy=function(){this.close.removeEventListener("click",this.closeWindow),this.album.length>1&&this.option.arrows&&this.control.removeEventListener("click",this.move),this.option.keyboard&&document.body.removeEventListener("keyup",this.keyEvents),t.removeEventListener("resize",this.resize),document.body.removeEventListener("click",this.bindEvent),this.mainWindow.parentNode.removeChild(this.mainWindow);for(var i in this)delete this[i]},t.WDSlideShow=e}(this);